<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>NEURAL ADMIN | AUDIO REACTIVE</title>
    <style>
        :root { --accent: #00ff41; --bg: #000; --text: #fff; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Helvetica', sans-serif; overflow: hidden; transition: 0.3s; }
        
        .bot {
            position: absolute; width: 10px; height: 10px;
            background: var(--accent); z-index: 5;
            border-radius: 2px; /* 稍微方一点，更有工业感 */
            transition: background 0.2s;
        }

        .ui-panel {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 320px; padding: 30px; background: rgba(0,0,0,0.95);
            border: 1px solid #333; text-align: center; z-index: 100;
            box-shadow: 0 0 40px rgba(0,0,0,1);
        }

        .val { font-size: 2.2rem; font-weight: 900; margin: 15px 0; color: var(--accent); letter-spacing: -1px; }
        h2 { font-size: 0.7rem; letter-spacing: 5px; color: #555; }
        
        button {
            width: 100%; padding: 15px; background: transparent; 
            border: 1px solid var(--accent); color: var(--accent); 
            cursor: pointer; font-weight: bold; margin-top: 10px;
            text-transform: uppercase; font-size: 0.7rem;
        }
        button:hover { background: var(--accent); color: #000; }

        .ye-active { --bg: #fff; --text: #000; --accent: #000; }
        .ye-active .ui-panel { background: #fff; border-color: #000; }
        #audio-status { font-size: 10px; color: #444; margin-top: 10px; }
    </style>
</head>
<body id="main-body">

    <div class="ui-panel">
        <h2 id="title">NEURAL STATUS</h2>
        <div class="val" id="display">STABLE</div>
        <div class="btns">
            <button onclick="runIntervention()">执行干预 (HEAL)</button>
            <button onclick="initAudio()" style="border-color: #f00; color: #f00;" id="ye-btn">ACTIVATE YE MODE</button>
        </div>
        <div id="audio-status">MIC: STANDBY</div>
    </div>

    <script>
        const body = document.getElementById('main-body');
        const display = document.getElementById('display');
        const bots = [];
        const count = 40;
        let isYe = false;
        let isHealing = false;

        // 音频相关变量
        let audioCtx, analyser, dataArray, source;

        // 1. 初始化粒子
        for(let i=0; i<count; i++) {
            const div = document.createElement('div');
            div.className = 'bot';
            document.body.appendChild(div);
            bots.push({
                el: div,
                x: Math.random() * window.innerWidth,
                y: Math.random() * window.innerHeight,
                vx: (Math.random() - 0.5) * 4,
                vy: (Math.random() - 0.5) * 4,
                baseSize: 8
            });
        }

        // 2. 音频初始化函数
        async function initAudio() {
            if (!audioCtx) {
                try {
                    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    source = audioCtx.createMediaStreamSource(stream);
                    analyser = audioCtx.createAnalyser();
                    analyser.fftSize = 256;
                    source.connect(analyser);
                    dataArray = new Uint8Array(analyser.frequencyBinCount);
                    document.getElementById('audio-status').innerText = "MIC: ONLINE (LISTENING TO BASS)";
                } catch (err) {
                    alert("无法获取麦克风权限，声波反应失效。");
                }
            }
            toggleYe();
        }

        function toggleYe() {
            isYe = !isYe;
            body.classList.toggle('ye-active');
            display.innerText = isYe ? "VULTURES" : "STABLE";
            document.getElementById('ye-btn').innerText = isYe ? "EXIT GRADUATION" : "ACTIVATE YE MODE";
        }

        // 3. 核心动画循环
        function animate() {
            let volume = 0;
            if (isYe && analyser) {
                analyser.getByteFrequencyData(dataArray);
                // 取低频部分（前 10 个频率点）计算平均音量，代表 Bass
                let sum = 0;
                for(let i=0; i<10; i++) sum += dataArray[i];
                volume = sum / 10; 
            }

            bots.forEach((b, index) => {
                if (isHealing) {
                    b.x += (window.innerWidth/2 - b.x) * 0.1;
                    b.y += (window.innerHeight/2 - b.y) * 0.1;
                } else {
                    // Kanye 模式下，速度受音量增益
                    const speedMultiplier = isYe ? (1 + volume / 50) : 1;
                    b.x += b.vx * speedMultiplier;
                    b.y += b.vy * speedMultiplier;

                    // 遇到 Bass 时，粒子产生随机位移抖动
                    if (isYe && volume > 100) {
                        b.x += (Math.random() - 0.5) * (volume / 10);
                        b.y += (Math.random() - 0.5) * (volume / 10);
                    }
                }

                // 边界检测
                if(b.x < 0 || b.x > window.innerWidth - 10) b.vx *= -1;
                if(b.y < 0 || b.y > window.innerHeight - 10) b.vy *= -1;

                // 视觉更新：大小随音量缩放
                const scale = isYe ? (1 + volume / 100) : 1;
                b.el.style.transform = `translate(${b.x}px, ${b.y}px) scale(${scale})`;
                
                // 颜色反应：重音时变色
                if (isYe && volume > 180) {
                    b.el.style.background = "#ff0000"; // 强烈节奏时变红
                } else {
                    b.el.style.background = isYe ? "#000" : "#00ff41";
                }
            });
            requestAnimationFrame(animate);
        }
        animate();

        function runIntervention() {
            isHealing = true;
            display.innerText = "HEALING...";
            setTimeout(() => {
                isHealing = false;
                display.innerText = isYe ? "VULTURES" : "STABLE";
            }, 1500);
        }
    </script>
</body>
</html>